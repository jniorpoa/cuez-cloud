# Cuez Cloud - Architecture Diagram

## Overview

```
                                    ┌─────────────────────────────┐
                                    │         INTERNET            │
                                    └──────────────┬──────────────┘
                                                   │
                              ┌────────────────────┼────────────────────┐
                              │                    │                    │
                              ▼                    ▼                    ▼
                    ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
                    │     ALGAR       │  │    MUNDIVOX     │  │   EMBRATEL      │
                    │ 189.112.178.129 │  │  187.16.97.66   │  │ 200.166.233.194 │
                    │      /28        │  │ 187.102.180.146 │  │       /28       │
                    └────────┬────────┘  └────────┬────────┘  └────────┬────────┘
                             │                    │                    │
                             │           ┌────────┴────────┐           │
                             │           │      SAMM       │           │
                             │           │ 201.87.158.162  │           │
                             │           │      /28        │           │
                             │           └────────┬────────┘           │
                             │                    │                    │
                             └────────────────────┼────────────────────┘
                                                  │
                                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                  AWS sa-east-1                                       │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐ │
│  │                            Internet Gateway                                     │ │
│  │                          cuez-cloud-igw                                         │ │
│  └────────────────────────────────────┬───────────────────────────────────────────┘ │
│                                       │                                              │
│  ┌────────────────────────────────────┼───────────────────────────────────────────┐ │
│  │                           VPC: 10.0.0.0/16                                      │ │
│  │                           cuez-cloud-vpc                                        │ │
│  │                                    │                                            │ │
│  │  ┌─────────────────────────────────┴─────────────────────────────────────────┐ │ │
│  │  │                    Public Subnet: 10.0.1.0/24                              │ │ │
│  │  │                    cuez-cloud-public-subnet                                │ │ │
│  │  │                    Availability Zone: sa-east-1a                           │ │ │
│  │  │                                                                            │ │ │
│  │  │   ┌──────────────────────────────┐   ┌──────────────────────────────┐     │ │ │
│  │  │   │                              │   │                              │     │ │ │
│  │  │   │      EC2: vMix Server        │   │      EC2: Cuez Server        │     │ │ │
│  │  │   │      ─────────────────       │   │      ─────────────────       │     │ │ │
│  │  │   │                              │   │                              │     │ │ │
│  │  │   │  Instance: t3.xlarge         │   │  Instance: t3.large          │     │ │ │
│  │  │   │  vCPU: 4 | RAM: 16GB         │   │  vCPU: 2 | RAM: 8GB          │     │ │ │
│  │  │   │  Storage: 500GB gp3          │   │  Storage: 500GB gp3          │     │ │ │
│  │  │   │  OS: Windows Server 2022     │   │  OS: Windows Server 2022     │     │ │ │
│  │  │   │                              │   │                              │     │ │ │
│  │  │   │  ┌────────────────────────┐  │   │  ┌────────────────────────┐  │     │ │ │
│  │  │   │  │    Security Group      │  │   │  │    Security Group      │  │     │ │ │
│  │  │   │  │    sg-vmix             │  │   │  │    sg-cuez             │  │     │ │ │
│  │  │   │  │ ────────────────────── │  │   │  │ ────────────────────── │  │     │ │ │
│  │  │   │  │ IN:  RDP   3389/TCP    │  │   │  │ IN:  RDP   3389/TCP    │  │     │ │ │
│  │  │   │  │ IN:  SRT   514/UDP     │  │   │  │ IN:  HTTP  80/TCP      │  │     │ │ │
│  │  │   │  │ IN:  HTTP  80/TCP      │  │   │  │ IN:  HTTPS 443/TCP     │  │     │ │ │
│  │  │   │  │ IN:  VPC   10.0.0.0/16 │  │   │  │ IN:  VPC   10.0.0.0/16 │  │     │ │ │
│  │  │   │  │ OUT: ALL   0.0.0.0/0   │  │   │  │ OUT: ALL   0.0.0.0/0   │  │     │ │ │
│  │  │   │  └────────────────────────┘  │   │  └────────────────────────┘  │     │ │ │
│  │  │   │                              │   │                              │     │ │ │
│  │  │   │  Private IP: 10.0.1.x       │◄──►│  Private IP: 10.0.1.x       │     │ │ │
│  │  │   │  Public IP:  (dynamic)       │   │  Public IP:  (dynamic)       │     │ │ │
│  │  │   │                              │   │                              │     │ │ │
│  │  │   └──────────────────────────────┘   └──────────────────────────────┘     │ │ │
│  │  │                                                                            │ │ │
│  │  └────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                  │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │                         Route Table: cuez-cloud-public-rt                 │   │ │
│  │  │  ──────────────────────────────────────────────────────────────────────  │   │ │
│  │  │  Destination        Target                                                │   │ │
│  │  │  10.0.0.0/16        local                                                 │   │ │
│  │  │  0.0.0.0/0          igw-xxxxx (Internet Gateway)                          │   │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                  │ │
│  └──────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow - SRT Streaming

```
┌──────────────┐     SRT 514/UDP      ┌──────────────┐
│   Encoder    │ ──────────────────►  │    vMix      │
│  (On-Prem)   │                      │   Server     │
└──────────────┘                      └──────┬───────┘
                                             │
                                             │ HTTP API / Intra-VPC
                                             │
                                             ▼
                                      ┌──────────────┐
                                      │    Cuez      │
                                      │   Server     │
                                      └──────┬───────┘
                                             │
                                             │ HTTPS 443
                                             │
                                             ▼
                                      ┌──────────────┐
                                      │  Operators   │
                                      │  (Browser)   │
                                      └──────────────┘
```

## Network CIDR Allocation

| Resource          | CIDR/IP              | Description                    |
|-------------------|----------------------|--------------------------------|
| VPC               | 10.0.0.0/16          | Main VPC                       |
| Public Subnet     | 10.0.1.0/24          | EC2 instances                  |
| Reserved          | 10.0.2.0/24 - 255    | Future expansion               |

## Security Group Rules Summary

### sg-vmix (vMix Server)

| Type    | Protocol | Port | Source           | Description          |
|---------|----------|------|------------------|----------------------|
| Ingress | TCP      | 3389 | Allowlist CIDRs  | RDP Access           |
| Ingress | UDP      | 514  | Allowlist CIDRs  | SRT Streaming        |
| Ingress | TCP      | 80   | Allowlist CIDRs  | HTTP/vMix Web        |
| Ingress | ALL      | ALL  | 10.0.0.0/16      | Intra-VPC            |
| Egress  | ALL      | ALL  | 0.0.0.0/0        | All Outbound         |

### sg-cuez (Cuez Server)

| Type    | Protocol | Port | Source           | Description          |
|---------|----------|------|------------------|----------------------|
| Ingress | TCP      | 3389 | Allowlist CIDRs  | RDP Access           |
| Ingress | TCP      | 80   | Allowlist CIDRs  | HTTP                 |
| Ingress | TCP      | 443  | Allowlist CIDRs  | HTTPS                |
| Ingress | ALL      | ALL  | 10.0.0.0/16      | Intra-VPC            |
| Egress  | ALL      | ALL  | 0.0.0.0/0        | All Outbound         |

## Allowlist IPs

| Provider  | CIDR                 | Range              |
|-----------|----------------------|--------------------|
| ALGAR     | 189.112.178.129/28   | .128 - .143        |
| MUNDIVOX  | 187.16.97.66/27      | .64 - .95          |
| MUNDIVOX  | 187.102.180.146/28   | .144 - .159        |
| EMBRATEL  | 200.166.233.194/28   | .192 - .207        |
| SAMM      | 201.87.158.162/28    | .160 - .175        |
